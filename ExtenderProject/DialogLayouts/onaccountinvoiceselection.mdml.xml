<?xml version="1.0" encoding="UTF-8"?>
<!-- RMA, 06/04/09: Create empty forms for every dialog (37642).-->
<!-- AMC, 12/06/09: Bellatrix Invoice On Account layout (37768).-->
<!-- JSV, 02/07/09: Insert Original layout converted from mdl and filter layout (37802).-->
<!-- MJA, 27/10/09: Update Original layout and remove Empty layout (37802).-->
<!-- AMC, 04/02/10: Delete unused experimental workspaces and layouts (38249).-->
<!-- JSV, 29/04/10: Use FullBoolean for Boolean fields open in new or update state (38472).-->
<!-- JSV, 22/07/10: Variable TransferredFromInvoicingPlanVar replaced by field (38244).-->
<!-- BPE, 02/09/10: Changed layout to use global definition dimensions (38745). -->
<!-- PBO, 22/09/10: Implement conditional layout (38843).-->
<!-- JSV, 29/11/10: Compact block for Original filter (39106).-->
<!-- PSZ, 03/12/10: Use onDemand suggestions for relevant fields (39127).-->
<!-- JSV, 04/03/11: New demo layouts (39458).-->
<!-- PSZ, 20/06/11: Original layout should be placed as the first layout (39299).-->
<!-- JSV, 21/06/11: New group "New Invoice on Account" in form "Demo" (39464).-->
<!-- JSV, 05/08/11: Main job invoicing based on job budgets (39800).-->
<!-- JSV, 19/08/11: Corrections after verification (39458).-->
<!-- JSV, 24/08/11: Use reference element where possible (39874).-->
<!-- SBA, 26/08/11: Change layout for job invoices workspace (39489).-->
<!-- JSV, 30/08/11: Description source for reference on CustomerNumber_Customer (39874).-->
<!-- JSV, 26/09/11: Order and group the actions in demo layout (39968).-->
<MDML xmlns="http://www.deltek.com/ns/mdml" version="0.59">
  <Layout source="OnAccountInvoiceSelection">
    <FilterPane>
      <Filter name="Standard">
        <Compact>
          <Description template="^1 (^2), ^3" arguments="JobName;JobNumber;Name1" />
        </Compact>
        <Columns>
          <Field source="JobNumber" />
          <Field source="JobName" />
          <Field source="JobGroup" />
          <Field source="NotInvoiceable" />
          <Field source="InternalJob" />
          <Field source="Status" />
          <Field source="ConvertedBy" />
          <Field source="ConversionDate" />
          <Field source="ProjectManagerNumber" />
          <Field source="SalesPersonNumber" />
        </Columns>
      </Filter>
    </FilterPane>
    <UpperPane>
      <Wizard name="InvoiceToCreditMemoAction" title="Invoice to Credit Memo">
        <Page form="InvoiceToCreditMemoActionPage" title="Enter the number of the invoice to credit" />
      </Wizard>
      <Form name="Full">
        <Actions all="true" />
        <Row>
          <Column>
            <Group title="Job">
              <Reference foreignKey="JobNumber_JobHeader" />
            </Group>
            <Group title="Customer">
              <Reference foreignKey="CustomerNumber_Customer" descriptionSource="Name1" />
              <Reference foreignKey="PaymentCustomer_Customer" />
            </Group>
            <Group title="Invoice">
              <Field source="PreferredInvoiceDate" title="Preferred Invoice Date" />
              <Field source="InvoiceName" />
            </Group>
            <Group title="Totals in Job Currency">
              <Grid style="grid_compact">
                <Header cells="|For Invoicing|;|On Drafts|;|Prev. Invoiced|;|Total|" title="" style="grid_header" />
                <Row cells="TotalTimeForInvoicingJobCurrencyVar;TotalTimeForInvoicingOnDraftsJobCurrencyVar;TotalTimePreviouslyInvoicedJobCurrencyVar;TotalTimeInvoicedPlusForInvoicingJobCurrencyVar" title="Time" />
                <Row cells="TotalAmountForInvoicingJobCurrencyVar;TotalAmountForInvoicingOnDraftsJobCurrencyVar;TotalAmountPreviouslyInvoicedJobCurrencyVar;TotalAmountInvoicedPlusForInvoicingJobCurrencyVar" title="Amount" />
                <Row cells="TotalForInvoicingJobCurrencyVar;TotalForInvoicingOnDraftsJobCurrencyVar;TotalPreviouslyInvoicedJobCurrencyVar;TotalInvoicedPlusForInvoicingJobCurrencyVar" title="Total" />
                <Row cells="TotalOutlayForInvoicingJobCurrencyVar;TotalOutlayForInvoicingOnDraftsJobCurrencyVar;TotalOutlayPreviouslyInvoicedJobCurrencyVar;TotalOutlayInvoicedPlusForInvoicingJobCurrencyVar" title="Outlay" />
                <Row cells="TotalFixedPriceForInvoicingJobCurrencyVar;TotalFixedPriceForInvoicingOnDraftsJobCurrencyVar;TotalFixedPricePreviouslyInvoicedJobCurrencyVar;TotalFixedPriceInvoicedPlusForInvoicingJobCurrencyVar" title="Incl. in Fixed Price" />
                <Row cells="FixedPriceJobCurrencyVar" title="Fixed Price" />
              </Grid>
            </Group>
            <Group title="Payment">
              <Field source="PaymentTerms" title="Pmt. Terms" />
              <Boolean source="ToBeBlanketInvoiced" />
              <Boolean source="VAT" />
              <Field source="Currency" />
            </Group>
          </Column>
          <Column>
            <Group title="Status">
              <Field source="OpenForInvoiceSelection" title="Open for Selection" />
              <Pair firstSource="ApprovedForInvoiceEditing" secondSource="NumberOfDraftsForEditingVar" title="Drafts for Editing" />
              <Pair firstSource="ApprovedForInvoicing" secondSource="NumberOfApprovedDraftsVar" title="Approved for Invoicing" />
              <Field source="ApprovedForInvoicingOnMainJob" title="Approved for Inv. on Main Job" />
              <Field source="ApprovedForInvoicingBy" title="Approved by" />
              <Field source="ApprovedForInvoicingDate" title="Approval Date" />
            </Group>
            <Group title="Currency">
              <EmptyLabel />
              <Field source="Currency" title="Job Currency" />
              <Field source="InvoiceCurrency" />
              <Boolean source="SpecifyInvoiceExchangeRate" />
              <Field source="InvoiceExchangeRateVar" title="Exchange Rate" />
            </Group>
            <Group title="Company">
              <Reference foreignKey="CompanyNumber_CompanyInformation" />
              <Field source="BaseCurrency" />
            </Group>
            <Group title="Settling Company">
              <Reference foreignKey="SettlingCompany_CompanyInformation" />
            </Group>
            <Group title="Credit Memo">
              <Field source="BasedOnInvoiceNumberVar" title="From Invoice No." />
            </Group>
          </Column>
        </Row>
      </Form>
      <Form name="InvoiceToCreditMemoActionPage">
        <Actions all="true" />
        <Group title="Credit Memo">
          <Field source="BasedOnInvoiceNumberVar" title="From Invoice No." />
        </Group>
      </Form>
      <Form name="Demo">
        <Actions all="true">
          <Exclude>
            <If condition="OnAccountForInvoicingInvoiceCurrency gt 0">
              <Action source="ApproveForCreditingOnAccount" />
            </If>
            <ElseIf condition="OnAccountForInvoicingInvoiceCurrency lt 0">
              <Action source="ApproveForInvoicingOnAccount" />
            </ElseIf>
          </Exclude>
          <Action source="InvoiceToCreditMemo" wizard="InvoiceToCreditMemoAction" />
          <Order>
            <Action ref="ApproveForInvoicingOnAccount" />
            <Action ref="PrintDraft" />
            <Action ref="PrintInvoice" />
            <Group title="More Actions">
              <Action ref="TransferInvoicingPlan" />
              <Action ref="UndoTransferInvoicingPlan" />
              <Action ref="RederiveVATCode" />
              <Action ref="NewInvoiceSelection" />
              <Action ref="ApproveForCreditingOnAccount" />
              <Action ref="PrintCreditMemo" />
              <Action ref="InvoiceToCreditMemo" />
              <Action ref="UndoInvoiceToCreditMemo" />
              <Action ref="RemoveLatestDraft" />
              <Action ref="RemoveApproval" />
            </Group>
          </Order>
        </Actions>
        <Row>
          <Column style="compact_amountAlignment">
            <Group title="Totals">
              <Grid>
                <Header cells="|For Invoicing|;|On Drafts|;|Invoiced|;|New Total|" titleValue="Currency" style="grid_header" />
                <Row cells="TotalTimeForInvoicingJobCurrencyVar;TotalTimeForInvoicingOnDraftsJobCurrencyVar;TotalTimePreviouslyInvoicedJobCurrencyVar;TotalTimeInvoicedPlusForInvoicingJobCurrencyVar" title="Time" />
                <Row cells="TotalAmountForInvoicingJobCurrencyVar;TotalAmountForInvoicingOnDraftsJobCurrencyVar;TotalAmountPreviouslyInvoicedJobCurrencyVar;TotalAmountInvoicedPlusForInvoicingJobCurrencyVar" title="Amount" />
                <Row cells="TotalForInvoicingJobCurrencyVar;TotalForInvoicingOnDraftsJobCurrencyVar;TotalPreviouslyInvoicedJobCurrencyVar;TotalInvoicedPlusForInvoicingJobCurrencyVar" title="Total" />
                <Row cells="TotalOutlayForInvoicingJobCurrencyVar;TotalOutlayForInvoicingOnDraftsJobCurrencyVar;TotalOutlayPreviouslyInvoicedJobCurrencyVar;TotalOutlayInvoicedPlusForInvoicingJobCurrencyVar" title="Outlay" />
                <Row cells="TotalFixedPriceForInvoicingJobCurrencyVar;TotalFixedPriceForInvoicingOnDraftsJobCurrencyVar;TotalFixedPricePreviouslyInvoicedJobCurrencyVar;TotalFixedPriceInvoicedPlusForInvoicingJobCurrencyVar" title="Incl. in Fixed Price" />
                <Row cells="_;_;_;FixedPriceJobCurrencyVar" title="Fixed Price" />
              </Grid>
            </Group>
          </Column>
          <Column>
            <Group title="Status">
              <If condition="BasedOnInvoiceNumber != 0">
                <Description title="Crediting" template="Invoice no. ^1" arguments="BasedOnInvoiceNumber" style="attentionText" />
              </If>
              <Description title="Open for Selection" template="^1" arguments="OpenForInvoiceSelection" />
              <If condition="ApprovedForInvoiceEditing">
                <Description title="Drafts for Editing" template="^1, ^2" arguments="ApprovedForInvoiceEditing;NumberOfDraftsForEditingVar" />
              </If>
              <Else>
                <Description title="Drafts for Editing" template="^1" arguments="ApprovedForInvoiceEditing" />
              </Else>
              <If condition="ApprovedForInvoicing">
                <Description title="Approved for Invoicing" template="^1, ^2" arguments="ApprovedForInvoicing;NumberOfApprovedDraftsVar" />
              </If>
              <Else>
                <Description title="Approved for Invoicing" template="^1" arguments="ApprovedForInvoicing" />
              </Else>
              <If condition="ApprovedForInvoicingBy != ''">
                <Description title="Approved" template="^1 by ^2" arguments="ApprovedForInvoicingDate;ApprovedForInvoicingBy" />
              </If>
            </Group>
            <Group title="Invoice">
              <Field source="PreferredInvoiceDate" title="Preferred Invoice Date" />
              <Field source="InvoiceName" />
            </Group>
          </Column>
          <Column>
            <Group title="New Invoice on Account" style="compact_amountAlignment" >
              <If condition="Activity1OnAccountFieldTitleVar != '' or Activity2OnAccountFieldTitleVar != ''">
                <Field title="Total" source="OnAccountForInvoicingInvoiceCurrency"  open="false"/>
                <Field titleValue="Activity1OnAccountFieldTitleVar" source="Activity1OnAccountForInvoicingInvoiceCurrencyVar" />
                <Field titleValue="Activity2OnAccountFieldTitleVar" source="Activity2OnAccountForInvoicingInvoiceCurrencyVar" />
              </If>
              <Else>
                <Field title="For Invoicing" source="OnAccountForInvoicingInvoiceCurrency" />
              </Else>
            </Group>
            <Group title="Currency" style="compact_textAlignment">
              <Field source="Currency" title="Job Currency" />
              <Field source="InvoiceCurrency" />
              <Boolean source="SpecifyInvoiceExchangeRate" />
              <Field source="InvoiceExchangeRateVar" title="Exchange Rate" />
            </Group>
          </Column>
        </Row>
      </Form>
      <Form name="Custom">
        <Actions all="true">
          <Exclude>
            <If condition="OnAccountForInvoicingInvoiceCurrency gt 0">
              <Action source="ApproveForCreditingOnAccount" />
            </If>
            <ElseIf condition="OnAccountForInvoicingInvoiceCurrency lt 0">
              <Action source="ApproveForInvoicingOnAccount" />
            </ElseIf>
          </Exclude>
          <Action source="InvoiceToCreditMemo" wizard="InvoiceToCreditMemoAction" />
          <Order>
            <Action ref="ApproveForInvoicingOnAccount" />
            <Action ref="PrintDraft" />
            <Action ref="PrintInvoice" />
            <Group title="More Actions">
              <Action ref="TransferInvoicingPlan" />
              <Action ref="UndoTransferInvoicingPlan" />
              <Action ref="RederiveVATCode" />
              <Action ref="NewInvoiceSelection" />
              <Action ref="ApproveForCreditingOnAccount" />
              <Action ref="PrintCreditMemo" />
              <Action ref="InvoiceToCreditMemo" />
              <Action ref="UndoInvoiceToCreditMemo" />
              <Action ref="RemoveLatestDraft" />
              <Action ref="RemoveApproval" />
            </Group>
          </Order>
        </Actions>
        <Row>
          <Column style="compact_amountAlignment">
            <Group title="Totals">
              <Grid>
                <Header cells="|For Invoicing|;|On Drafts|;|Invoiced|;|New Total|" titleValue="Currency" style="grid_header" />
                <Row cells="TotalTimeForInvoicingJobCurrencyVar;TotalTimeForInvoicingOnDraftsJobCurrencyVar;TotalTimePreviouslyInvoicedJobCurrencyVar;TotalTimeInvoicedPlusForInvoicingJobCurrencyVar" title="Time" />
                <Row cells="TotalAmountForInvoicingJobCurrencyVar;TotalAmountForInvoicingOnDraftsJobCurrencyVar;TotalAmountPreviouslyInvoicedJobCurrencyVar;TotalAmountInvoicedPlusForInvoicingJobCurrencyVar" title="Amount" />
                <Row cells="TotalForInvoicingJobCurrencyVar;TotalForInvoicingOnDraftsJobCurrencyVar;TotalPreviouslyInvoicedJobCurrencyVar;TotalInvoicedPlusForInvoicingJobCurrencyVar" title="Total" />
                <Row cells="TotalOutlayForInvoicingJobCurrencyVar;TotalOutlayForInvoicingOnDraftsJobCurrencyVar;TotalOutlayPreviouslyInvoicedJobCurrencyVar;TotalOutlayInvoicedPlusForInvoicingJobCurrencyVar" title="Outlay" />
                <Row cells="TotalFixedPriceForInvoicingJobCurrencyVar;TotalFixedPriceForInvoicingOnDraftsJobCurrencyVar;TotalFixedPricePreviouslyInvoicedJobCurrencyVar;TotalFixedPriceInvoicedPlusForInvoicingJobCurrencyVar" title="Incl. in Fixed Price" />
                <Row cells="_;_;_;FixedPriceJobCurrencyVar" title="Fixed Price" />
              </Grid>
            </Group>
          </Column>
          <Column>
            <Group title="Status">
              <If condition="BasedOnInvoiceNumber != 0">
                <Description title="Crediting" template="Invoice no. ^1" arguments="BasedOnInvoiceNumber" style="attentionText" />
              </If>
              <Description title="Open for Selection" template="^1" arguments="OpenForInvoiceSelection" />
              <If condition="ApprovedForInvoiceEditing">
                <Description title="Drafts for Editing" template="^1, ^2" arguments="ApprovedForInvoiceEditing;NumberOfDraftsForEditingVar" />
              </If>
              <Else>
                <Description title="Drafts for Editing" template="^1" arguments="ApprovedForInvoiceEditing" />
              </Else>
              <If condition="ApprovedForInvoicing">
                <Description title="Approved for Invoicing" template="^1, ^2" arguments="ApprovedForInvoicing;NumberOfApprovedDraftsVar" />
              </If>
              <Else>
                <Description title="Approved for Invoicing" template="^1" arguments="ApprovedForInvoicing" />
              </Else>
              <If condition="ApprovedForInvoicingBy != ''">
                <Description title="Approved" template="^1 by ^2" arguments="ApprovedForInvoicingDate;ApprovedForInvoicingBy" />
              </If>
            </Group>
            <Group title="Invoice">
              <Field source="PreferredInvoiceDate" title="Preferred Invoice Date" />
              <Field source="InvoiceName" />
            </Group>
          </Column>
          <Column>
            <Group title="New Invoice on Account" style="compact_amountAlignment" >
              <If condition="Activity1OnAccountFieldTitleVar != ''">
                <Field title="Total" source="OnAccountForInvoicingInvoiceCurrency" open="false"/>
                <Field titleValue="Activity1OnAccountFieldTitleVar" source="Activity1OnAccountForInvoicingInvoiceCurrencyVar" />
              </If>
              <Else>
                <Field title="For Invoicing" source="OnAccountForInvoicingInvoiceCurrency" />
              </Else>
            </Group>
            <Group title="Currency" style="compact_textAlignment">
              <Field source="Currency" title="Job Currency" />
              <Field source="InvoiceCurrency" />
              <Boolean source="SpecifyInvoiceExchangeRate" />
              <Field source="InvoiceExchangeRateVar" title="Exchange Rate" />
            </Group>
          </Column>
        </Row>
      </Form>
    </UpperPane>
    <LowerPane>
      <Define>
        <Include fragment="GD_Dimensions" />
      </Define>
      <Table name="Full">
        <Actions all="true" />
        <Columns>
          <Field source="Description" />
          <Field source="BillingPriceForInvoicingInvoiceCurrency" />
          <Field source="InvoiceCurrencyVar" title="Invoice Currency" />
          <If condition="maconomy:booleanSysPar('UseMultipleVATLevels')">
            <Field source="VATCode" />
            <Field source="VATCode2" />
            <If condition="maconomy:booleanSysPar('ShowThreeVATLevels')">
              <Field source="VATCode3" />
            </If>
          </If>
          <Else>
            <Field source="VATCode" title="Tax Code" />
          </Else>
          <Field source="ActivityNumber" />
          <Field source="ActivityDescriptionVar" title="Activity Name" />
          <Field source="IncludedInFixedPrice" />
          <Field source="ActivityType" />
          <Field source="TaskName" />
          <Field source="TaskDescriptionVar" title="Task Description{1}" />
          <Field source="EmployeeNumber" />
          <Field source="EmployeeNameVar" title="Employee Name" />
          <Field source="BillingPriceForInvoicingCurrencyVar" title="Billing Price, Currency" />
          <Field source="TransferredFromInvoicingPlan" />
          <Field source="InvoiceAllocation" />
          <Field source="PaymentCustomer" />
          <Field source="Appropriation" />
          <Field source="BudgetJobNumber" />
          <Columns ref="DimensionColumns" />
        </Columns>
      </Table>
      <Table name="Demo">
        <Actions all="true" />
        <Columns>
          <Field source="Description" />
          <UnitField source="BillingPriceForInvoicingInvoiceCurrency" unitSource="InvoiceCurrencyVar" />
          <If condition="maconomy:booleanSysPar('UseMultipleVATLevels')">
            <Field source="VATCode" />
            <Field source="VATCode2" />
            <If condition="maconomy:booleanSysPar('ShowThreeVATLevels')">
              <Field source="VATCode3" />
            </If>
          </If>
          <Else>
            <Field source="VATCode" title="Tax Code" />
          </Else>
          <Field source="TransferredFromInvoicingPlan" title="Transferred from Plan" />
          <Field source="TaskName" />
          <Field source="TaskDescriptionVar" title="Task Description{1}" />
          <Field source="IncludedInFixedPrice" />
          <If condition="parent.Currency != InvoiceCurrencyVar">
            <Field source="BillingPriceForInvoicingCurrencyVar" title="Billing Price, Currency" />
          </If>
          <Field source="PaymentCustomer" />
          <Field source="Appropriation" />
        </Columns>
      </Table>
      <Table name="Custom">
        <Actions all="true" />
        <Columns>
          <Field source="Description" />
          <UnitField source="BillingPriceForInvoicingInvoiceCurrency" unitSource="InvoiceCurrencyVar" />
          <If condition="maconomy:booleanSysPar('UseMultipleVATLevels')">
            <Field source="VATCode" />
            <Field source="VATCode2" />
            <If condition="maconomy:booleanSysPar('ShowThreeVATLevels')">
              <Field source="VATCode3" />
            </If>
          </If>
          <Else>
            <Field source="VATCode" title="Tax Code" />
          </Else>
          <Field source="TransferredFromInvoicingPlan" title="Transferred from Plan" />
          <Field source="TaskName" open="false" />
          <Field source="TaskDescriptionVar" title="Task Description{1}" />
          <Field source="IncludedInFixedPrice" />
          <If condition="parent.Currency != InvoiceCurrencyVar">
            <Field source="BillingPriceForInvoicingCurrencyVar" title="Billing Price, Currency" />
          </If>
          <Field source="PaymentCustomer" />
          <Field source="Appropriation" />
        </Columns>
      </Table>
    </LowerPane>
  </Layout>
</MDML>

